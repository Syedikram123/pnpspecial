<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Happy New Year</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Poppins, sans-serif;
    }
    body {
      background: #000;
      color: #fff;
      text-align: center;
      overflow-x: hidden;
    }
    #fireworksCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }
    .container {
      width: 90%;
      max-width: 600px;
      margin: auto;
      padding: 60px 0;
    }
    h1 {
      font-size: 45px;
      font-weight: 700;
      color: #ffe066;
      text-shadow: 0 0 21px #ffcc00;
    }
    h2 {
      margin-top: 45px;
      font-size: 24px;
      color: #ffcd4d;
    }
    .offer-btn {
      margin-top: 65px;
      padding: 16px 28px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #ffe066;
      color: #000;
      font-weight: 700;
      cursor: pointer;
    }
    .offer-text {
      margin-top: 70px;
      margin-bottom: 75px;
      font-size: 28px;
      color: #7CFF6B;
      font-weight: 700;
    }

/* LOADING SCREEN */
#loadingScreen{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:20px;
  z-index:10;
}

.loader{
  width:50px;
  height:50px;
  border:5px solid #333;
  border-top:5px solid #ffe066;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}

#unlockBtn{
  padding:10px 26px;
  font-size:25px;
  background:#ffe066;
  color:#000;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  display:none;
}
@media (max-width: 375px) {
      .newyear-heading {
        font-size: 37px;
      }
    }
    .fade-out {
      opacity: 0;
      transition: 1s;
    }
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingScreen">
  <div class="loader"></div>
  <button id="unlockBtn" onclick="unlockPage()">Unlock</button>
</div>

<canvas id="fireworksCanvas"></canvas>

<div class="container" id="mainContent">
  <h1 class="newyear-heading">Happy New Year</h1>
  <h2 id="shopName"></h2>

  <button id="offerBtn" class="offer-btn" onclick="goInsta()" style="display:none">
  </button>

  <div id="offerText" class="offer-text" style="display:none"></div>
</div>

<footer style="text-align:center; padding:12px 8px; font-size:16px;">
    <span style="color:#ffffff;">© Since 2018</span> &nbsp;|&nbsp;
    <span style="color:#49B618; font-weight:780;">paper 'n' print</span> &nbsp;|&nbsp;
    <a href="https://wa.me/918951337609?text=What's%20the%20rate%20for%20the%20digital%20e%20cards" target="_blank" style="color:#ffffff; text-decoration:none; font-weight:500;">
      <i class="fa-brands fa-whatsapp"></i>
    </a>
  </footer>

<audio id="bgSound" src="assets/crackers.mp3" loop></audio>

<script>
/* SHOW UNLOCK AFTER 2 SECONDS */
setTimeout(()=>{
  document.querySelector(".loader").style.display="none";
  document.getElementById("unlockBtn").style.display="block";
},2000);

function unlockPage(){
  document.getElementById("loadingScreen").style.display="none";
  document.getElementById("mainContent").style.display="block";
  document.getElementById("bgSound").play();
}

/* SHOP DATA + OFFER LOGIC */
const params=new URLSearchParams(location.search);
const shopId=params.get("id");

fetch("https://script.google.com/macros/s/AKfycbykeCX5c6arlIVAGqSOUbHBeLGo7NVwJ6O17A7Wia3jjkWW3pl34J5prNTdEJiJLAA/exec?id="+shopId)
.then(r=>r.json())
.then(d=>{
  shopName.innerText = `— ${d.shop_name} —`;

  if (localStorage.getItem("followed_" + shopId)) {
    offerText.innerHTML = `Congratulations!<br>${d.offer_amount}`;
    offerText.style.display = "block";
  } else {
    offerBtn.style.display = "inline-block";

    // ✅ THIS IS THE MISSING LINE
    offerBtn.innerText = d.button_text || "Follow our Instagram for exclusive offer";
  }

  window.instaLink = d.instagram;
});


function goInsta(){
  localStorage.setItem("followed_"+shopId,true);
  window.open(instaLink,"_blank");
  setTimeout(()=>location.reload(),1500);
}
</script>

<script>
/* FIREWORKS */
const canvas=document.getElementById("fireworksCanvas");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;
onresize=()=>{canvas.width=innerWidth;canvas.height=innerHeight};

function r(min,max){return Math.random()*(max-min)+min}

class Firework{
  constructor(){
    this.x=r(0,canvas.width);
    this.y=canvas.height;
    this.t=r(50,canvas.height/2);
    this.s=r(3,6);
    this.b=false;
    this.p=[];
  }
  update(){
    if(!this.b){
      this.y-=this.s;
      if(this.y<=this.t){
        this.b=true;
        for(let i=0;i<40;i++)this.p.push(new Particle(this.x,this.y));
      }
    }
  }
  draw(){if(!this.b){ctx.fillStyle="#fff";ctx.fillRect(this.x,this.y,3,6)}}
}

class Particle{
  constructor(x,y){
    this.x=x;this.y=y;
    this.vx=r(-3,3);this.vy=r(-3,3);
    this.a=1;
  }
  update(){this.x+=this.vx;this.y+=this.vy;this.a-=0.02}
  draw(){
    ctx.fillStyle=`rgba(255,200,80,${this.a})`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,3,0,Math.PI*2);
    ctx.fill();
  }
}

let f=[];
(function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(Math.random()<0.05)f.push(new Firework());
  f.forEach((fw,i)=>{
    fw.update();fw.draw();
    if(fw.b){
      fw.p.forEach((p,j)=>{
        p.update();p.draw();
        if(p.a<=0)fw.p.splice(j,1);
      });
      if(fw.p.length===0)f.splice(i,1);
    }
  });
  requestAnimationFrame(animate);
})();
</script>

</body>
</html>
